# NTIN043: Homework 4

## Topic: Online Shopping in TLA+/PlusCal

### Task: Create model for the whole process associated with online shopping (Amazon, Alza.cz)
	- you should capture in particular the following steps: choosing items, payment by credit card, authorization on cell phone, checkout from store, delivery
	- other important aspects: multiple clients using the e-shop at the same time

### Solution

#### Preface 

The solution captures the fundamental workflow of the online shopping platform. However it does not incorporate the payment details in the states as its rather complicated in terms of number of variables and constants. Nevertheless, the details can be integrated in the already defined states of the State Machine defined by the TLA+ spec.

The State Machine has 5 states (6th state \[idle] was not finnished since it produced design errors and non-determinism, that needs to be re-designed). The specs then describes the following states:
 - *browsing*  <- customer/shopper just browses the online store without any interaction with the products/commodities
 - *selecting* <- customer/shopper picks the prouct from the collecton of the available products
 - *ordering*  <- customer/shopper orders the product
 - *shipped*   <- customer/shopper ordered the product
 - *served*    <- customer/shopper was served and does not want to browse/select anymore

There is one global state where the simulation starts - *OnlineShopping*. This state initiates then the simulation where each customer can individually interacts with the Online Store and available products and Model (see below) then verifies for any possible combination.

The fundamental of the simulation is hidden in the following collections:
 - Commodities  <- Array of the product prices indexed by the product id 
 - Customers    <- Array of all customers' solvencies indexed by the customer

##### Model
The module specifies two main constants:
    - Shoppers <- set of individual customers, i.e. {"Pepan", "Jitka", "Honza"}
    - Products <- set of product IDs, i.e. {98,10,26}

Despite the fact that the size of the modeled constants are limited, we must consider that all options being computed. Thus for simplicity we use this elemental model.


The PDF below describes the solution. It was generated by the Toolbox and MiKTex, but fill free to use the ![code](./OnlineShoppingPlatform.tla). The project containts also the toolobx generated project so fill free to reuse the model attached (model_2).

<object data="./OnlineShoppingPlatform.pdf" type="application/pdf" width="700px" height="700px">
    <embed src="./OnlineShoppingPlatform.pdf">
        <p>This browser does not support PDFs. Please download the PDF to view it: <a href="./OnlineShoppingPlatform.pdf">Download PDF</a>.</p>
    </embed>
</object>


### Conclusion
The TLA+ opposed to the CPN was more intuitive in terms of abstraction of the system and specifying the desired behaviour of the system. However, the abstraction and the way the system needs to be thought of is rather complex and requires time and effort. I personally used Leslie Lamport's video lectures to understand the construct of the TLA+. Even though it was described very well, it is challenging to design full specifications that would cover all the requirements in this particular case. I did not use the PlusCalc since I didn't see the benefit of doing so, since I would not understand then the generated code and its semantics (omitting the fact that the specification would be possible readable and developed quicker). The TLA+ Toolbox was helfull in the evaluation of the models as well as the syntax control, however I found my self comfortable to use VSCode for the writting of the spec and the Toolbox only for the evaluation.

What is quite interesting that the AWS uses the TLA+ extensively on more than 14 of their projects. Considering the time pressure in such a company, the modeling of their system must be demanding.

#### Feature extension / What was not covered

- **Payments** - despite the fact that it supposed to be part of the solution (infrastructure is prepared in terms of product prices and customers' solvencies), I have omitted it from the solution, since the writting in the TLA+ is slow process requiring the construction of the individual conjunctions. The states of the State Machine would howerer would not change at all (meaning in counts or relation), since the payment expression could be integrated in the *order* state.
- **Availability** - the way of the handling the availability is vague and needs to be updated relating to the previous point of payment. The spec needs to cover case, where the good was already bought / or the customer does not have sufficient amount of money, so the another customer can proceed to order.
- **Idle** - This state was not incorporated, since it made the solution really fragile and needs to be redesigned. In nutshell, this is the state, where the user does not interact with the Online Store.